<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>CoreDataEnvirSample by xudeheng</title>
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-dark.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="javascripts/respond.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <!--[if lt IE 8]>
    <link rel="stylesheet" href="stylesheets/ie.css">
    <![endif]-->
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

  </head>
  <body>
      <div id="header">
        <nav>
          <li class="fork"><a href="https://github.com/xudeheng/CoreDataEnvir">View On GitHub</a></li>
          <li class="downloads"><a href="https://github.com/xudeheng/CoreDataEnvir/zipball/master">ZIP</a></li>
          <li class="downloads"><a href="https://github.com/xudeheng/CoreDataEnvir/tarball/master">TAR</a></li>
          <li class="title">DOWNLOADS</li>
        </nav>
      </div><!-- end header -->

    <div class="wrapper">

      <section>
        <div id="title">
          <h1>CoreDataEnvirSample</h1>
          <p>A CoreData Envirement wrapper, use CoreData in convient way. It has been used in my works.</p>
          <hr>
          <span class="credits left">Project maintained by <a href="https://github.com/xudeheng">xudeheng</a></span>
          <span class="credits right">Hosted on GitHub Pages &mdash; Theme by <a href="https://twitter.com/michigangraham">mattgraham</a></span>
        </div>

        <h1>
<a id="coredataenvir-since-2011-05-25-latest-version-04" class="anchor" href="#coredataenvir-since-2011-05-25-latest-version-04" aria-hidden="true"><span class="octicon octicon-link"></span></a>CoreDataEnvir (since 2011-05-25) latest version 0.4</h1>

<p>CoreDataEnvir is a CoreData wrapper which use CoreData in convient way and keep safe in multithread programming. You can use it concurrenctlyï¼Œrun seperate CoreDataEnvir instance on one thread.</p>

<h2>
<a id="first-step" class="anchor" href="#first-step" aria-hidden="true"><span class="octicon octicon-link"></span></a>First step:</h2>

<p>Register your data base file name</p>

<pre><code>    [CoreDataEnvir registDatabaseFileName:@"db.sqlite"];
</code></pre>

<p>Register your model file name(no file extension name)</p>

<pre><code>    [CoreDataEnvir registModelFileName:@"SampleModel"];
</code></pre>

<h2>
<a id="simple-data-base-access" class="anchor" href="#simple-data-base-access" aria-hidden="true"><span class="octicon octicon-link"></span></a>Simple data base access:</h2>

<p>Let's assumption the <code>Book</code> class is a model which represent a book object in your reading app. It has some field are <code>name</code>, <code>author</code> ... etc.</p>

<p>There is an author "John Stevens Cabot Abbott" written a book named "Napoleon Bonnaparte".</p>

<h3>
<a id="add-new-record" class="anchor" href="#add-new-record" aria-hidden="true"><span class="octicon octicon-link"></span></a>Add new record</h3>

<pre><code>
[Book insertItemWithFillingBlock:^(id item) {
    item.name = @"CoreData tutorial";
    item.author = @"Headwindx";
}];

</code></pre>

<h3>
<a id="fetch-lots-of-records" class="anchor" href="#fetch-lots-of-records" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fetch lots of records</h3>

<pre><code>//Find all books of John Stevens Cabot Abbott.
NSArray *books= [Feed itemsWithFormat:@"author = %@",  @"John Stevens Cabot Abbott"];

</code></pre>

<h3>
<a id="fetch-one-record" class="anchor" href="#fetch-one-record" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fetch one record</h3>

<pre><code>//Find one book model object.
Book *book = [Book lastItemWithFormat:@"name = %@ &amp;&amp; author = %@", @"Napoleon Bonnaparte", @"John Stevens Cabot Abbott"];

</code></pre>

<h3>
<a id="delete-one-record" class="anchor" href="#delete-one-record" aria-hidden="true"><span class="octicon octicon-link"></span></a>Delete one record</h3>

<pre><code>[CoreDataEnvir asyncMainInBlock:^(CoreDataEnvir *db) {
        [db deleteDataItem:book];
}];

</code></pre>

<h3>
<a id="delete-records" class="anchor" href="#delete-records" aria-hidden="true"><span class="octicon octicon-link"></span></a>Delete records</h3>

<pre><code>[CoreDataEnvir asyncMainInBlock:^(CoreDataEnvir *db) {
        [db deleteDataItemSet:books];
}];
</code></pre>

<h2>
<a id="concurrenct-programming" class="anchor" href="#concurrenct-programming" aria-hidden="true"><span class="octicon octicon-link"></span></a>Concurrenct programming:</h2>

<h3>
<a id="on-main-thread" class="anchor" href="#on-main-thread" aria-hidden="true"><span class="octicon octicon-link"></span></a>On main thread</h3>

<p>You can do some lightweight operation on main thread. All of above operation must runs on main thread by default or it will raise an exception by <code>CoreDataEnvir</code>. So you should be carefully.</p>

<h4>
<a id="you-also-can-explicit-use-on-main-thread" class="anchor" href="#you-also-can-explicit-use-on-main-thread" aria-hidden="true"><span class="octicon octicon-link"></span></a>You also can explicit use on main thread</h4>

<p>It makes you feel more safe :-)</p>

<pre><code>[CoreDataEnvir asyncMainInBlock:^(CoreDataEnvir *db) {
    [Book insertItemWithFillingBlock:^(id item) {
        item.name = @"CoreData tutorial";
        item.author = @"Headwindx";
    }];
}];
</code></pre>

<h3>
<a id="on-background-thread" class="anchor" href="#on-background-thread" aria-hidden="true"><span class="octicon octicon-link"></span></a>On background thread</h3>

<p>It's already prepared a background GCD queue for you in <code>CoreDataEnvir</code>.</p>

<p>The block <code>asyncBackgroundInBlock</code> will save memory cache to db file after <code>void(^)(CoreDataEnvir *db)</code> works finished.</p>

<p>You don't need to use <code>[db saveDataBase];</code> like older version.</p>

<pre><code>
[CoreDataEnvir asyncBackgroundInBlock:^(CoreDataEnvir *db) {
    [Book insertItemOnBackgroundWithFillingBlock:^(id item) {
        item.name = @"CoreData tutorial";
        item.author = @"Headwindx";
    }];
}];

</code></pre>

<p>It becomes more conveniently on concurrenct programming.</p>

<h3>
<a id="convenient-methods" class="anchor" href="#convenient-methods" aria-hidden="true"><span class="octicon octicon-link"></span></a>Convenient methods</h3>

<p>Must run on main queue:</p>

<ul>
<li><code>+ (void)asyncMainInBlock:(void(^)(CoreDataEnvir *db))CoreDataBlock;</code></li>
<li><code>+ (id)insertItemWithFillingBlock:(void(^)(id item))fillingBlock;</code></li>
<li>
<code>+ (NSArray *)itemsWithFormat:(NSString *)fmt,...;</code>
...</li>
</ul>

<p>Must run on background queue, you can use these APIs and some methods name within <code>Background</code>:</p>

<ul>
<li><code>+ (void)asyncBackgroundInBlock:(void(^)(CoreDataEnvir *db))CoreDataBlock;</code></li>
<li><code>+ (id)insertItemOnBackgroundWithFillingBlock:(void(^)(id item))fillingBlock;</code></li>
<li>
<code>+ (NSArray *)itemsOnBackgroundWithFormat:(NSString *)fmt,...;</code>
...</li>
</ul>

<p>Or you wanna run some operation in your own dispatch queue, you can choose this APIs:</p>

<ul>
<li>
<code>+ (CoreDataEnvir *)createInstance;</code> you'd better hold this instance for future.</li>
<li><code>- (void)asyncInBlock:(void(^)(CoreDataEnvir *db))CoreDataBlock;</code></li>
</ul>

<h2>
<a id="if-your-are-newcomer-to-coredata-please-obey-the-rules-below" class="anchor" href="#if-your-are-newcomer-to-coredata-please-obey-the-rules-below" aria-hidden="true"><span class="octicon octicon-link"></span></a>If your are newcomer to CoreData, please obey the rules below:</h2>

<p>If you wanna keep you NSManagedObject objects, you shouldn't release you CoreDataEnvir object or it will be fault. So if you operate data base in multiple threads, make sure your NSManagedObject object reference fetched from [CoreDataEnvir mainInstance] or [CoreDataEnvir backgroundInstance] which never be released until application exist and it's enough for usual.</p>
      </section>

    </div>
    <!--[if !IE]><script>fixScale(document);</script><![endif]-->
    
  </body>
</html>
